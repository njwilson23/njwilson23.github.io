<html>
  <head>
    <meta charset="utf-8">
    <title>Where is Nat?</title>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
    <script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
  </head>
  <body>

    <style type="text/css">
      #completed {
        background-color: steelblue;
      }
      #remaining {
        background-color: firebrick;
        opacity: 0.8;
      }
      div.bar {
        width: auto;
        height: auto;
        overflow: hidden;
      }
      div.barComponent {
        height: 5em;
        float: left;
      }
      body {
        margin-left: auto;
        margin-right: auto;
        width: 90%;
        font-family: Helvetica, Arial, sans;
      }
      #map {
        height: 480px;
      }
    </style>

    <h1>Where is Nat?</h1>

    <h2>Trip completion</h2>

    <div class="bar">
      <div class="barComponent" id="completed"></div>
      <div class="barComponent" id="remaining"></div>
    </div>
    <div style="float: clear;"></div>

    <h2>Location</h2>

    <p><a href="http://www.sailwx.info/shiptrack/shipposition.phtml?call=DBLK">Polarstern location tracker</a></p>

    <div id="map"></div>

    <script>

      function update() {
        var startTime = new Date(2016, 6, 8, 14),
            endTime = new Date(2016, 8, 9, 20);

        var totalMilliseconds = endTime - startTime;

        d3.select("#completed").style("width",
            function() { return Math.min(100, Math.max(0, (new Date()-startTime) / totalMilliseconds * 100)) + "%" });

        d3.select("#remaining").style("width",
            function() { return Math.min(100, Math.max(0, (endTime-new Date()) / totalMilliseconds * 100)) + "%" });
      }
      update();
      setInterval(update, 5000)

    </script>

    <script>
      var map = L.map('map').setView([75, -5], 3);

      L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/Ocean_Basemap/MapServer/tile/{z}/{y}/{x}', {
	        attribution: 'Tiles &copy; Esri &mdash; Sources: GEBCO, NOAA, CHS, OSU, UNH, CSUMB, National Geographic, DeLorme, NAVTEQ, and Esri',
	        maxZoom: 13
      }).addTo(map);

      L.marker([69.678649, 18.986411]).addTo(map)
          .bindPopup('Tromsø (mid July and early September)');

      L.marker([79.735830, -20.242157]).addTo(map)
          .bindPopup('Nioghalvfjerdsbræ (late August)');

      L.marker([79, -0.75]).addTo(map)
          .bindPopup('Fram Strait moorings (late July-August)');

      L.marker([32.827932, -117.264979]).addTo(map)
          .bindPopup('La Jolla (mid July)');

      L.marker([49.25, -123.1]).addTo(map)
          .bindPopup('Vancouver (September)');
    </script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-47441592-3', 'auto');
      ga('send', 'pageview');

    </script>
  </body>
</html>
